<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Happy Birthday Rose</title>
  <style>
   body {
  margin: 0;
  height: 100vh;
  background-color: #008080;
  background-image: 
    repeating-linear-gradient(45deg, rgba(255,255,255,0.05) 0, rgba(255,255,255,0.05) 1px, transparent 1px, transparent 4px),
    repeating-linear-gradient(-45deg, rgba(255,255,255,0.05) 0, rgba(255,255,255,0.05) 1px, transparent 1px, transparent 4px);
  background-size: 8px 8px;
  font-family: 'Tahoma', system-ui, -apple-system, Segoe UI, sans-serif;
  overflow: hidden;
  cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32'><text y='24' font-size='24'>ü¶â</text></svg>") 16 16, auto;
}

.window .resize-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  right: 0;
  bottom: 0;
  cursor: se-resize;
  background: rgba(0,0,0,0.2);
  z-index: 10;
}

.window {
  resize: both;
  overflow: auto;
}

.scale-wrapper {
  transform-origin: top left;
}

@keyframes floaty {
  0% { transform: translateY(-4px) rotate(-0.4deg);} 
  50% { transform: translateY(6px) rotate(0.4deg);} 
  100% { transform: translateY(-4px) rotate(-0.4deg);} 
}

.space {
  position: relative;
  width: 100%;
  height: 100%;
}

.folder {
  position: absolute;
  width: 160px;
  padding: 8px;
  background: #ece9d8;
  border: 2px solid #000;
  box-shadow: 3px 3px 0 #000;
  cursor: move;
  user-select: none;
  animation: floaty 7s ease-in-out infinite;
}

.folder-header {
  display:flex;
  gap:6px;
  align-items:center;
}

.folder-title {
  font-size: 14px;
  font-weight: bold;
}

.scrap-edge {
  border: 1px dashed #555;
  transform: rotate(-1deg);
  background: repeating-linear-gradient(45deg,#fffef9,#fffef9 6px,#fff7d6 6px,#fff7d6 12px);
  padding:6px;
}

.window {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: min(640px, 92%);
  max-height: 80vh;
  background: #ece9d8;
  border: 2px solid #000;
  box-shadow: 6px 6px 0 #000;
  display: none;
  resize: both;
  overflow: auto;
}

.title-bar {
  display:flex;
  justify-content: space-between;
  align-items:center;
  background: linear-gradient(180deg,#000080,#000060);
  color:white;
  padding:4px 8px;
  font-size:14px;
  cursor: move;
}

.buttons span {
  background:#c0c0c0;
  border:1px solid #000;
  padding:0 6px;
  margin-left:4px;
  color:#000;
  cursor:pointer;
}

.content {
  padding:14px 16px;
  font-size:13px;
}

.gallery {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(120px,1fr));
  gap:10px;
}

.gallery img {
  width:100%;
  height:120px;
  object-fit:cover;
  border:2px solid #000;
  box-shadow:3px 3px 0 #000;
}

.icon {
  position:absolute;
  color:white;
  text-align:center;
  width:80px;
  font-size:14px;
  cursor:pointer;
}

.icon img {
  width:48px;
  height:48px;
  display:block;
  margin:0 auto 4px;
}

.hint {
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 11px;
  color:white;
  opacity:.8;
}

.birthday-watermark {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: clamp(40px, 8vw, 120px);
  font-weight: bold;
  color: rgba(255, 255, 255, 0.1);
  text-align: center;
  pointer-events: none;
  user-select: none;
  z-index: 0;
  max-width: 90%;
  line-height: 1.1; 
  word-wrap: break-word;
}

/* Music Controls */
#music-controls {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(0, 0, 0, 0.85);
  border: 2px solid #fff;
  border-radius: 12px;
  padding: 12px;
  z-index: 50;
  display: none;
  flex-direction: column;
  gap: 8px;
  min-width: 200px;
}

#music-controls.active {
  display: flex;
}

.control-row {
  display: flex;
  gap: 8px;
  align-items: center;
  justify-content: center;
}

.music-btn {
  padding: 8px 12px;
  border: 1px solid #fff;
  background: #000;
  color: #fff;
  cursor: pointer;
  border-radius: 6px;
  font-size: 14px;
  transition: background 0.2s;
}

.music-btn:hover {
  background: #333;
}

.music-btn:active {
  background: #555;
}

#track-info {
  color: #fff;
  text-align: center;
  font-size: 12px;
  padding: 4px;
  border-bottom: 1px solid #444;
  margin-bottom: 4px;
}

#track-title {
  font-weight: bold;
  margin-bottom: 2px;
}

/* Voiceover Controls */
.voiceover-control {
  display: none;
  background: #c0c0c0;
  border: 2px outset #fff;
  padding: 8px;
  margin: 12px 0;
  text-align: center;
}

.voiceover-control.active {
  display: block !important;  /* Add !important to ensure it overrides */
}

.voiceover-btn {
  background: #000080;
  color: white;
  border: 2px outset #fff;
  padding: 6px 14px;
  cursor: pointer;
  font-family: 'Tahoma', sans-serif;
  font-size: 13px;
  margin: 0 4px;
}

.voiceover-btn:hover {
  background: #0000a0;
}

.voiceover-btn:active {
  border-style: inset;
}

.voiceover-btn.playing {
  background: #006400;
}

.voiceover-status {
  font-size: 11px;
  margin-top: 4px;
  color: #555;
}

/* Crossword Styles */
.crossword-main {
  display: grid;
  grid-template-columns: 1fr 300px;
  gap: 20px;
  align-items: start;
}

@media (max-width: 900px) {
  .crossword-main {
    grid-template-columns: 1fr;
  }
}

.crossword-grid-wrapper {
  display: flex;
  justify-content: center;
  background: white;
  padding: 15px;
  border: 2px solid #000;
  box-shadow: 3px 3px 0 #000;
  overflow-x: auto;
}

.crossword-grid {
  display: inline-grid;
  gap: 0;
  background: #000;
  border: 2px solid #000;
  max-width: 100%;
}

.crossword-cell {
  width: 28px;
  height: 28px;
  background: white;
  border: 1px solid #999;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.crossword-cell.black {
  background: #000;
  border: none;
}

.crossword-cell input {
  width: 100%;
  height: 100%;
  border: none;
  text-align: center;
  font-size: 13px;
  font-weight: bold;
  text-transform: uppercase;
  font-family: 'Courier New', monospace;
  background: transparent;
  padding: 0;
}

.crossword-cell input:focus {
  background: #ffffcc;
  outline: 2px solid #000080;
  outline-offset: -2px;
}

.crossword-cell.correct input {
  background: #90EE90 !important;
}

.cell-number {
  position: absolute;
  top: 1px;
  left: 2px;
  font-size: 7px;
  font-weight: bold;
  pointer-events: none;
  z-index: 1;
}

.crossword-clues-panel {
  background: white;
  border: 2px solid #000;
  box-shadow: 3px 3px 0 #000;
  padding: 12px;
  max-height: 70vh;
  overflow-y: auto;
  width: 320px;
  flex-shrink: 0;
}

.crossword-clue-section {
  margin-bottom: 15px;
}

.crossword-clue-section h3 {
  border-bottom: 2px solid #000080;
  padding-bottom: 4px;
  margin-top: 0;
  font-size: 14px;
}

.crossword-clue-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.crossword-clue-list li {
  margin: 5px 0;
  padding: 3px;
  font-size: 13px;
  line-height: 1.4;
}

.crossword-complete-message {
  display: none;
  background: #90EE90;
  padding: 12px;
  border: 2px solid #006400;
  text-align: center;
  font-weight: bold;
  margin: 10px 0;
}

.crossword-secret-box {
  display: none;
  margin-top: 20px;
  padding: 25px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border: 3px solid #000;
  box-shadow: 4px 4px 0 #000;
  text-align: center;
  color: white;
  animation: revealBox 0.8s ease-out;
}

@keyframes revealBox {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.crossword-secret-box h2 {
  font-size: 24px;
  margin-top: 0;
}

.crossword-secret-box p {
  font-size: 16px;
  margin: 12px 0;
}


  </style>
</head>

<body>

<!-- Background Music -->
<audio id="bg-music" loop playsinline>
  <source src="https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/petal.mp3" type="audio/mpeg">
</audio>

<!-- Voiceover Audio Elements -->
<audio id="voiceover-personal" preload="metadata">
  <source src="https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/personal-voiceover.m4a" type="audio/mp4">
</audio>
<audio id="voiceover-memories" preload="metadata">
  <source src="https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/memories-voiceover.m4a" type="audio/mp4">
</audio>
<audio id="voiceover-secret" preload="metadata">
  <source src="https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/crossword.m4a" type="audio/mp4">
</audio>
<audio id="voiceover-letters" preload="metadata">
  <source src="https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/letters-voiceover.m4a" type="audio/mp4">
</audio>
<audio id="voiceover-dragon" preload="metadata">
  <source src="https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/dragon2.m4a" type="audio/mp4">
</audio>

<!-- Music Controls Widget -->
<div id="music-controls">
  <div id="track-info">
    <div id="track-title">Loading...</div>
    <div id="track-counter">Track 1 of 11</div>
  </div>
  <div class="control-row">
    <button id="mute-btn" class="music-btn">üîä silence please</button>
    <button id="skip-btn" class="music-btn">‚è≠Ô∏è skip</button>
  </div>
  <div class="control-row">
    <button id="play-pause-btn" class="music-btn">‚è∏Ô∏è pause</button>
  </div>
</div>

<!-- Music Start Fallback Overlay -->
<div id="music-start" style="position:fixed;inset:0;background:rgba(0,0,0,0.85);color:white;display:none;align-items:center;justify-content:center;z-index:60;font-family:Tahoma;">
  <!-- Background Image -->
  <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;height:80%;background-image:url('https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/album%20cover.JPG');background-size:contain;background-repeat:no-repeat;background-position:center;opacity:0.75;pointer-events:none;"></div>
  
  <!-- Content -->
  <div style="text-align:center;position:relative;z-index:1;">
    <div style="margin-bottom:12px;font-size:16px;">üé∂üéµ tap or click to start the musicüéµüé∂</div>
    <button id="music-btn" style="padding:6px 14px;border:2px solid #fff;background:#000;color:#fff;cursor:pointer;">begin!</button>
  </div>
</div>

<!-- Boot Screen Overlay -->
<div id="boot-screen" style="position:fixed;top:0;left:0;width:100%;height:100%;background:black;color:#39ff14;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;font-family:monospace;">
  <div id="boot-text" style="font-size:18px;margin-bottom:16px;">a very happy birthday is loading...</div>
  <div style="width:260px;height:10px;background:#222;border:1px solid #0f0;">
    <div id="boot-progress" style="height:100%;width:0%;background:#39ff14;"></div>
  </div>
</div>

<canvas id="confetti-canvas" style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;"></canvas>

<div class="space">

  <div class="icon" style="top:20px; left:20px;" onclick="openWindow('readme')">
    üìÑ
    README.txt
  </div>

  <div class="icon" style="top:100px; left:20px;" onclick="openWindow('trash')">
    üóë
    Recycle Bin
  </div>

 <div class="icon" style="top:180px; left:20px;" onclick="openWindow('words')">
    üìù
    Words
  </div>

  <div class="folder scrap-edge" style="top:18%; left:14%;" onmousedown="startDrag(event,this)" onclick="openWindow('personal')">
    <div class="folder-header">üìÅ<span class="folder-title">your birthday message ma'am</span></div>
  </div>

  <div class="folder scrap-edge" style="top:62%; left:22%;" onmousedown="startDrag(event,this)" onclick="openWindow('memories')">
    <div class="folder-header">üìÅ<span class="folder-title">some pictures from liverpool st station</span></div>
  </div>

  <div class="folder scrap-edge" style="top:30%; left:70%;" onmousedown="startDrag(event,this)" onclick="openWindow('letters')">
    <div class="folder-header">üìÅ<span class="folder-title">activity time</span></div>
  </div>

<div class="folder scrap-edge" style="top:55%; left:65%;" onmousedown="startDrag(event,this)" onclick="openWindow('crossword')">
  <div class="folder-header">üìÅ<span class="folder-title">crossword puzzle</span></div>
</div>

<div class="birthday-watermark">HAPPY 20th BIRTHDAY ROSE</div>

<div id="personal" class="window">
  <div class="title-bar" onmousedown="startDragWindow(event,this.parentElement)">bday message.txt<div class="buttons"><span onclick="closeWindow(this)">X</span></div></div>
  <div class="scale-wrapper">
    <div class="content">

      <!-- Voiceover Control -->
      <div class="voiceover-control" id="voiceover-control-personal">
        <div style="font-weight: bold; margin-bottom: 6px;">üé§ Voice Message</div>
        <button class="voiceover-btn" onclick="toggleVoiceover('personal')">‚ñ∂Ô∏è Play Voice Message</button>
        <div class="voiceover-status" id="status-personal"></div>
      </div>
      
      <h1>Hey free bird</h1>

<h2>Happy birthday</h2>

<p> Unbelievably this is completely unprepared writing. This is the last thing left to do on this. Unfortunately(?) I don't have the emotional underpinning of a teary 1am FaceTime with you so the poetic eloquence might not be up to the standard you've grown to expect, but I'll try say some nice things- no promises you'll have any ratatouille pen moments though. Sorry. Just pre-empting your typical faint criticism. And the time I told you I loved the way you used words you told me off for tactical flirtation but I did and do mean it. I fear this doesn't come close. </p>

<p>Please don't worry I am writing this under no naively optimistic pretences! And secretly/obviously I always preferred the (more literal) term "rose tinted glasses" anyway. </p>
<p>Things have been going well with my betrothed princess since the king found out no dragon was actually getting released on us. </p>

<br>I don't think I told you enough how much I recognised and appreciated even the smallest things in your gift: I know how much each and every one of those stars on the envelope meant in the moment. And the book! I wanted to quickly say thanks again for your book! Your favourite of the year?! To me?! Huge. Very fly. I loved it. Million more things to say obviously, but ive heard im a good person to talk to, so I didn't want to put all my thoughts etc here. So many movies and books and art to discuss! Hopefully soon. </br>

<p>I know I said that the paint set was your present and it is actually quite a good one but but but come on now. Didn't feel right! I got your favourite book of last year AND an artwork (albeit one you're not proud of) and you don't even get my handwriting with this... And I can't be part of / use my own present to you so the paint stuff can't count. So I got you something very small to keep in sight on your desk. Hopefully it will help motivate you when you're stuck there and need a smile. Motivate is the wrong word because you're driven enough but you know when you need something extra to help you through it? It'll help. It'll be closer than chips at least. </p> 

<br>A favourite quote of mine is about notes like these, and says that they can only be written properly without knowing what you're going to write when you set out, and without knowing what you have written at the end. It's already a blur, so at least I've done something right. Now for what I actually want to say to you on your actual birthday... Gosh. Have a good one. I hope you enjoy it. I hope your party goes well. I wish I was there, genuinely. Just to celebrate you. And help with (/take over) the playlist. I still remember being really surprised/happy when you invited me that night on instagram. Even I hadn't thought that far ahead. Okay obviously I had, but still. I hope the Cambridge crowd don't get too drunk and no jealous feelings arise between your heartbreaker friends. And if/when they do I hope you don't have to problem solve/mediate/fix/help/soothe for long. </br>
<p>It's really hard to write this. I have so little to say <strong><em>to</em></strong> you, but so much to say <strong><em>with</em></strong>. Like in terms of advice? Keep your neck and chest covered when it's windy and cold? Trust your gut? Have good intentions? Don't let anyone (else) ruin your sleep schedule? I don't know. I hope you have a year and subsequent lifetime filled with won arguments, laughter, and Anton Ego pen drops and childhood-zoom-when-tasting-the-ratatouille moments. And Remy strawberry and cheese moments. Preferably from art of all kinds. Try listen to new music, not just the sopranos' theme and harry styles. I don't know if I ever told you but that "woke up this morning" song is my ringtone for you lmao. Use my weekly playlists if you want. And try watch a few movies doing nothing else. Christ I can't believe I've used your birthday message to say watch movies better. Don't let this hit your ego and turn this into an "ohmygosh we only had good conversations because I was the good conversation and he gave nothing wow I had fun with him because I was fun and he was just there" moment, but I really have nothing else to offer you in this single-sided format of speaking <em>at</em> you, blind, distant, and across pixels. I hope to speak with you sometime soon.
I do think the activity button says everything I could want to kind of impart onto you right now. So on that note, I hope the birthday is good. I hope it's the best. I wish you all the best. I hope it's fly, in the way only you would describe. I hope it's fly like the freest of birds. And I wish for you to begin your twenties better than little Rosie ever imagined. </p>

<br><p>And lastly this is actually infecting your computer with a billion viruses. King's orders. Sorry. </p>
<p>No just kidding</p></br>

<br>Happy birthday prim. </br>

<p>Your simple boy,<p>
<p>Ismail. </p>
    </div>
  </div>
</div>

<div id="memories" class="window">
  <div class="title-bar" onmousedown="startDragWindow(event,this.parentElement)">Photos.exe<div class="buttons"><span onclick="closeWindow(this)">X</span></div></div>
  <div class="scale-wrapper">
    <div class="content">
      <!-- Voiceover Control -->
      <div class="voiceover-control" id="voiceover-control-memories">
        <div style="font-weight: bold; margin-bottom: 6px;">üé§ Voice Message</div>
        <button class="voiceover-btn" onclick="toggleVoiceover('memories')">‚ñ∂Ô∏è Play Voice Message</button>
        <div class="voiceover-status" id="status-memories"></div>
      </div>
      
      <p>got these developed</p>
<p>two blurry bad ones (obvs I love them because happy but yk) either side of two absolute stunners imo. something about your hair and eyes being the same colour as the lights behind. I like the black and white versions of them all (hit the top left button on each of them) but my favourite picture of them all is the BnW middle right picture where you're using your phone camera. And you can't complain about having orange hair in the bnw edits. Also the very album cover-esque photo of you on the start page came out really nice too! I doubted you would want them (because I can already hear the complaints), but they're in the locked folder on the mem stick. </p>
      <div class="gallery">
        <img src="https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/blurry%20happy%20look.JPG" alt="" onclick="openImageViewer(0)">
        <img src="https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/woah.JPG" alt="" onclick="openImageViewer(1)">
<img src="https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/pic.JPG" alt="" onclick="openImageViewer(2)">
        <img src="https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/blurry%20happy.JPG" alt="" onclick="openImageViewer(3)">
      </div>
    </div>
  </div>
</div>

<div id="secret-folder" class="window">
  <div class="title-bar" onmousedown="startDragWindow(event,this.parentElement)">Secret_Folder.exe<div class="buttons"><span onclick="closeWindow(this)">X</span></div></div>
  <div class="scale-wrapper">
    <div class="content">
      <div class="dragon-guard">
        <div class="pixel-dragon">
          <pre>
    /\_/\  
   ( o.o ) 
  < | ^ | >
  /|   |\
  (_|   |_)
 ~~~DRAGON~~~
          </pre>
        </div>
        <p style="text-align: center; font-weight: bold; margin: 10px 0;">This folder is protected by the dragon!</p>
        <div class="password-box">
          <label>Enter Password:</label>
          <input type="password" id="dragonPassword" placeholder="****">
          <button onclick="checkDragonPassword()">Enter</button>
        </div>
        <p id="passwordError" style="color: red; text-align: center; display: none;">Wrong password! The dragon won't let you pass.</p>
      </div>
      
      <div id="secretContent" style="display: none;">

        <div id="crossword-video-reveal" style="display: none; margin: 20px 0; text-align: center; animation: fadeIn 0.8s;">
          <video width="560" height="315" controls style="max-width: 100%; border: 2px solid #000; box-shadow: 3px 3px 0 #000;">
            <source src="https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/Norm Macdonald Tells The Greatest Joke Ever Told.mp4" type="video/mp4">
          </video>
        </div>

        <h3 style="text-align: center;">üéâ You made it past the dragon! üéâ</h3>

        <!-- DRAGON VOICEOVER - BACK INSIDE secretContent -->
        <div class="voiceover-control" id="voiceover-control-dragon">
          <div style="font-weight: bold; margin-bottom: 6px;">üé§ Voice Message</div>
          <button class="voiceover-btn" onclick="toggleVoiceover('dragon')">‚ñ∂Ô∏è Play Voice Message</button>
          <div class="voiceover-status" id="status-dragon"></div>
        </div>
  
        <p>congrats free bird enjoy this</p>
        <p>so some cool backstory. Heard this score when younger. Loved it. I genuinely think I only heard the score a few times before this holiday because it empties out my entire chest each and every time and left me feeling so much. It is on my playlist of 'hidden songs' on Spotify that don't ever come up on shuffle etc because I physically cannot hear them. There's like 20 or so. Anyways, back to this one. Loved it so so much that I refused to watch the movie. I don't quite know how to articulate it but it was in case the film didn't hit the emotional beats the way I'd been moved by them in my head and then it was forever tainted? Anyways the film was incredible and has one of my favourite scenes of all time in any movie. I wrote out the entire scene here but decided to delete it bc I'll let you watch. Or. It <I>is</I> on our list. The one you aren't privy to. But anyway I decided to learn the piece by ear and write an arrangement and play it. I decided this the day you gave me your present and every day I've been home since I've worked on it and I actually recorded myself every time I made some progress as a fun little log. But here you get to see me perform it on your birthday: the 13th. I got some art you weren't proud of. You'll get some I am pretty proud of. Enjoy idk. The first time I played the chords I teared up but I didnt feel any emotion for the entire month and then when I played them this time I broke again. </p>
        <p><I>P.S. I know the dragon bit doesn't actually make sense as the dragon was meant to defeat me but actually I've gone pretty meta with it and its you defeating your own backfiring imaginary dragons yada yada</I></p>
        <div style="text-align: center;">
          <iframe width="420" height="315" src="https://www.youtube.com/embed/mmK71ZfaZO4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
          <img src="https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/album%20cover.JPG" width="472" height="315">
        </div>
      </div>
    </div>
  </div>
</div>


<div class="hint">happy birthday free bird, go ahead and drag around the folders, open em up, and explore. Hope u like the colours ü¶âü¶å</div>

<div id="persistent-dragon-icon" class="dragon-icon" onclick="openWindow('secret-folder')" style="display: none;">
  üêâ
</div>


<style>
.dragon-guard {
  text-align: center;
  padding: 20px;
}

.pixel-dragon {
  background: #000;
  color: #0f0;
  font-family: 'Courier New', monospace;
  font-size: 20px;
  display: inline-block;
  padding: 20px;
  border: 3px solid #0f0;
  margin: 20px auto;
  text-shadow: 0 0 5px #0f0;
  animation: dragonGlow 2s infinite alternate;
}

@keyframes dragonGlow {
  from { box-shadow: 0 0 5px #0f0; }
  to { box-shadow: 0 0 20px #0f0, 0 0 30px #0f0; }
}

.password-box {
  margin: 20px auto;
  max-width: 300px;
  background: #c0c0c0;
  padding: 15px;
  border: 2px inset #fff;
}

.password-box label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
}

.password-box input {
  width: calc(100% - 10px);
  padding: 5px;
  border: 2px inset #fff;
  margin-bottom: 10px;
  font-family: 'MS Sans Serif', sans-serif;
}

.password-box button {
  width: 100%;
  padding: 5px 15px;
  background: #c0c0c0;
  border: 2px outset #fff;
  cursor: pointer;
  font-family: 'MS Sans Serif', sans-serif;
  font-weight: bold;
}

.password-box button:active {
  border-style: inset;
}

.secret-gallery {
  display: flex;
  gap: 15px;
  justify-content: center;
  flex-wrap: wrap;
  margin-top: 20px;
}

.secret-gallery img {
  width: 200px;
  height: 200px;
  object-fit: cover;
  border: 2px solid #000;
  box-shadow: 2px 2px 0 rgba(0,0,0,0.3);
}

#secretContent {
  animation: fadeIn 0.5s;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
</style>


<!-- Image Viewer Modal -->
<div id="imageViewer" class="image-viewer">
  <div class="image-viewer-content">
    <div class="viewer-header">
      <button onclick="toggleBW()" class="bw-toggle">B&W</button>
      <span class="viewer-close" onclick="closeImageViewer()">X</span>
    </div>
    <img id="viewerImage" src="" alt="">
  </div>
</div>

<style>
.gallery {
  display: grid;
  gap: 15px;
  justify-content: space-around;
  align-items: center;
  padding: 20px;
  width: 100%;
}

.gallery img {
  width: 150px;
  height: 150px;
  object-fit: cover;
  cursor: pointer;
  transition: transform 0.2s;
  border: 2px solid #000;
  box-shadow: 2px 2px 0 rgba(0,0,0,0.3);
}

.gallery img:hover {
  transform: scale(1.05);
}

.image-viewer {
  display: none;
  position: fixed;
  z-index: 10000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.8);
}

.image-viewer-content {
  position: relative;
  margin: 5% auto;
  width: 80%;
  max-width: 800px;
  background: #c0c0c0;
  border: 2px solid #000;
  box-shadow: 2px 2px 0 #000;
}

.viewer-header {
  background: #000080;
  color: white;
  padding: 5px 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.bw-toggle {
  background: #c0c0c0;
  border: 2px outset #fff;
  padding: 2px 10px;
  cursor: pointer;
  font-family: inherit;
}

.bw-toggle:active {
  border-style: inset;
}

.viewer-close {
  background: #c0c0c0;
  border: 2px outset #fff;
  padding: 2px 10px;
  cursor: pointer;
  font-weight: bold;
}

.viewer-close:active {
  border-style: inset;
}

#viewerImage {
  width: 100%;
  height: auto;
  display: block;
  transition: filter 0.3s;
}

#viewerImage.bw {
  filter: grayscale(100%);
}
</style>

<script>
const images = [
  {
    color: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/blurry%20happy%20look.JPG",
    bw: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/blurry%20happy%20look%20bnw.JPG" //
  },
  {
    color: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/woah.JPG",
    bw: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/woah%20bnw.JPG"
  },
 {
    color: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/pic.JPG",
    bw: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/pic%20bnw.JPG"
  },
  {
    color: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/blurry%20happy.JPG",
    bw: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/blurry%20happy%20bnw.JPG"
  }
 
];

let currentImageIndex = 0;
let isBW = false;

function openImageViewer(index) {
  currentImageIndex = index;
  isBW = false;
  const viewer = document.getElementById('imageViewer');
  const viewerImage = document.getElementById('viewerImage');
  
  viewerImage.src = images[index].color;
  viewerImage.classList.remove('bw');
  viewer.style.display = 'block';
}

function closeImageViewer() {
  document.getElementById('imageViewer').style.display = 'none';
}

function toggleBW() {
  const viewerImage = document.getElementById('viewerImage');
  isBW = !isBW;
  
  if (isBW) {
    viewerImage.src = images[currentImageIndex].bw;
    viewerImage.classList.remove('bw');
  } else {
    viewerImage.src = images[currentImageIndex].color;
    viewerImage.classList.remove('bw');
  }
}

// Close viewer when clicking outside the image
document.getElementById('imageViewer').onclick = function(e) {
  if (e.target === this) {
    closeImageViewer();
  }
}
</script>

<div id="letters" class="window">
  <div class="title-bar" onmousedown="startDragWindow(event,this.parentElement)">activity time!.doc<div class="buttons"><span onclick="closeWindow(this)">X</span></div></div>
  <div class="scale-wrapper">
    <div class="content">
      <!-- Voiceover Control -->
      <div class="voiceover-control" id="voiceover-control-letters">
        <div style="font-weight: bold; margin-bottom: 6px;">üé§ Voice Message</div>
        <button class="voiceover-btn" onclick="toggleVoiceover('letters')">‚ñ∂Ô∏è Play Voice Message</button>
        <div class="voiceover-status" id="status-letters"></div>
      </div>
      
      <ul>
        <p>Ive never really cared much about time. i know I have those weekly playlists but thats moreso for posterity like for my kids to listen to what their dad listened to that week 20 years ago. But genuinely the passage of it has never really meant much to me in any capacity. i became aware that cambridge terms felt much faster than the holidays and now all of a sudden I'm one more academic term from my finals. So that was me knowing cambridge felt weird. But with you everything around us seemed to be contextualised in temporal terms and the more that happened the more confused my perception of everything got so as usual I just ignored it and stayed happy. again, you're a good person to talk to, so im trying to keep all of this to a minimum before all the thoughts and discussions come out. But this has a point! An actual direction lmao. Please be patient.</p>

<p>So, the cool part is that you reading this right now from the day you handed me my present is actually the exact same amount of days from when I first saw you in downing to you leaving for varsity.</p>
<p>Every chip! </p>
<p>Every terrible(/y brilliant) long joke I told! </p>
<p>Every shiver when I'd been outside in sidgewick for slightly too long! </p>
<p>Every coffee! and tea! and kiss! and laugh!</p>
<p>Every droopy eyed Instagram message! </p>
<p>Every foiled plan!</p>
<p>Every new unpolished pair of shoes, and every dark item of clothing that made you talk about adding some colour into your wardrobe</p>
<p>Every loud "I knew that" and every silent stunned "wow I had no idea"...</p>
<p>Our kings parade interactions from your first "why are you being weird and quiet" to me all the way to the 'font of wisdom' taxi driver that night picking you up from lola's‚Ä¶</p>
<p>The women in the cinema!</p>
<p>Every topic we agreed on before we'd even brought it up, every artist, historic period, surprisingly/not so surprisingly lewd message, every highly exclaimed whAT! of yours (and mine once id stopped laughing with<sup>(*at)</sup> you).</p> 
<p>And every song. There's a few playing here hopefully. And a mute button for when you're trying to focus on the words and its all a bit much stimulation.</p>

<p>I could go on, and fear I have, but you get my point. </p>

<p>8th Nov to 6th Dec, and 16th Dec to 13th Jan.</p>
<p>28 days, no more no less. </p>

<p>Now those are two very different feeling periods of the same amount of sunrises and sunsets. Which I think is awesome and I dont think it's useful or fun or chic or suave or fly to think otherwise or focus on anything real like months or dates or whatever. I dont even know what day of the week it is right now making this. Right anyway I have an actual point. </p>

<p>There are exactly 13 more of these 28 day periods between now and the day you turn 21. And wow look at that lucky number 13 what's next is today going to be the 13th or something yes wow. 28 days is the exact number of days it takes to make something officially a habit, according to some bullshit, but I've quit things in seconds, and developed practices in my life over years, and vice versa.</p>

<p>That's just something to think about. like dont worry about life and shit and time and days and weeks and months and minutes and years, because you know that some of these thirteen little periods that make up your next year can sometimes feel like 4, and some feel like just days, but also years, and its all so confusing and none of it is real. So this is me trying to say. Focus on the moment, and dont try think some moments matter more than others because you actually never know.</p>

<p>So yeah I want you to do something for me for you(?) from me? I dont know. But do this. </p>

<p>Right now what I want you to do is write down 13 things you love. It sounds easy! But there's more. It can't be things you love always and forever like friendship and family, and nor can it be things that you love in general, like Martin Parr's photos or King Edgar essays or art or music or being condescending or the smell of books etc etc</p>
<p>It needs to be specific things you love right NOW. This second. And try make them as internal as possible. Be selfish! Be whatever you feel. But try to be internal and in the moment. You might love how your hair looks in this angle right this second in this light, or how your drink tastes, or you might love that a memory of the builders in your room just popped into your head as you looked around, or you might love a song you just heard this morning and can't get out of your head, or you might love how ginny is looking at you right now slightly bewildered. Write down 13 of these fleeting, momentary, tiny personal things that you love right now. I want you to find thoughts and feelings in your head that are beautiful and yet will be absent by the end of the night and tomorrow you'll love something else even more and wish you wrote that down instead but they are special because of that!</p>
<p>Don't overthink it. Don't take your time. Just write! And then take a picture and attach it to an email. Address it to yourself and schedule it for 13/01/2027. Happy 21st. Hopefully each and every single one of these will be a completely forgotten memory very soon, and by the time of your next birthday you'll be reminded of 13 things you once found beautiful. And it might feel like yesterday you did this and it might feel like 5 years ago, but like I've said‚Ä¶ the only important part is it'll FEEL!! it's not goals or aims or bullshit it's real actual feelings you have right now to be reminded of in a year's time. And I think that'll be pretty cool. Hopefully it reminds 21 year old rose to have a look around and take in the moment a bit before what I imagine to be a mahoosive day/year/lifetime of fun. </p>
      </ul>
    </div>
  </div>
</div>

<div id="wishes" class="window">
  <div class="title-bar" onmousedown="startDragWindow(event,this.parentElement)">piano.com<div class="buttons"><span onclick="closeWindow(this)">X</span></div></div>
  <div class="scale-wrapper">
    <div class="content">
      <p>Your hopes, encouragement, and birthday wishes.</p>    
    </div>
  </div> 
</div>

<div id="readme" class="window">
  <div class="title-bar" onmousedown="startDragWindow(event,this.parentElement)">README.txt<div class="buttons"><span onclick="closeWindow(this)">X</span></div></div>
  <div class="scale-wrapper">
    <div class="content">
      <p>no don't read this read the rest smh</p>
    </div>
  </div>
</div>

<div id="trash" class="window">
  <div class="title-bar" onmousedown="startDragWindow(event,this.parentElement)">Recycle Bin<div class="buttons"><span onclick="closeWindow(this)">X</span></div></div>
  <div class="scale-wrapper">
    <div class="content">
      <p>why would you want to delete any of this it's great what are you doing</p>
    </div>
  </div>
</div>

<div id="words" class="window">
  <div class="title-bar" onmousedown="startDragWindow(event,this.parentElement)">words.txt<div class="buttons"><span onclick="closeWindow(this)">X</span></div></div>
  <div class="scale-wrapper">
    <div class="content">
      <p>hey hey so you know how I told you about words that kind of feel and sound like exactly what they are? The only one I could think of at the time was obelisk. Later on we discovered gnaw, and then scavenge. In the meantime, I've come up with a few more: </p>
<ul>
	<li>sob</li>
	<li>plummet</li>
	<li>grasp</li>
	<li>scourge</li>
</ul>
<p>plummet is the weakest there but definitely works if you have ever felt your chest plummet, because if you breathe in before you say it you have to exhale it gives the exact same feeling as the word describes. Maybe you'll come across a couple more someday too and tell me about them.</p>
    </div>
  </div>
</div>

<div id="crossword" class="window" style="width: min(1600px, 98%); max-height: 90vh;">  <div class="title-bar" onmousedown="startDragWindow(event,this.parentElement)">crossword_puzzle.exe<div class="buttons"><span onclick="closeWindow(this)">X</span></div></div>
  <div class="scale-wrapper">
    <div class="content">
     <div class="crossword-complete-message" id="crossword-complete-msg">
  üéâ CONGRATULATIONS! You solved the crossword! üéâ
</div>


<div class="crossword-secret-box" id="crossword-secret-box">
<!-- Voiceover Control - This will auto-play -->
<div class="voiceover-control active" id="voiceover-control-secret">
  <div style="font-weight: bold; margin-bottom: 6px;">üé§ Voice Message</div>
  <button class="voiceover-btn" onclick="toggleVoiceover('secret')" id="btn-secret">‚ñ∂Ô∏è Play Voice Message</button>
    
    <!-- Progress Bar -->
    <div style="margin-top: 8px;">
      <input type="range" id="secret-progress" min="0" max="100" value="0" style="width: 100%; cursor: pointer;">
      <div style="display: flex; justify-content: space-between; font-size: 10px; margin-top: 2px;">
        <span id="secret-current-time">0:00</span>
        <span id="secret-duration">0:00</span>
      </div>
    </div>
    
<div class="voiceover-status" id="status-secret"></div>
  </div>
  <h2>üéä You did it rose wooooo üéä</h2>
  <p>some fun memories in there right</p>
<p> but dont get too excited you'll never get the same layout of words - sure you'll remember the prompts and clues and words after some time but I hope you can glean some enjoyment out of this for a bit longer by seeing the different layouts </p>
  <p>‚ô•Ô∏è</p>
</div>

<div class="crossword-main">
  <div class="crossword-grid-wrapper">
    <div id="crossword-grid" class="crossword-grid"></div>
  </div>
  
  <div class="crossword-clues-panel">
    <div class="crossword-clue-section">

      <h3>ACROSS</h3>
      <ul class="crossword-clue-list" id="crossword-across-clues"></ul>
    </div>
    <div class="crossword-clue-section">
      <h3>DOWN</h3>
      <ul class="crossword-clue-list" id="crossword-down-clues"></ul>
    </div>
  </div>
</div>

<script>
// Confetti animation
const confettiCanvas = document.getElementById('confetti-canvas');
confettiCanvas.width = window.innerWidth;
confettiCanvas.height = window.innerHeight;
const ctx = confettiCanvas.getContext('2d');

const confetti = [];
for(let i=0;i<80;i++){
  confetti.push({
    x: Math.random() * confettiCanvas.width,
    y: Math.random() * confettiCanvas.height,
    r: Math.random() * 6 + 2,
    d: Math.random() * 0.3 + 0.1,
    color: ['#FFD700','#FF6347','#ADFF2F','#87CEFA','#FF69B4'][Math.floor(Math.random()*5)],
    swayPhase: Math.random() * Math.PI * 2,
    swayAmplitude: Math.random() * 5 + 2
  });
}

function drawConfetti(){
  ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  confetti.forEach(f=>{
    ctx.beginPath();
    ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
    ctx.fillStyle = f.color;
    ctx.fill();
    f.y += f.d;
    f.x += Math.sin(f.y * 0.05 + f.swayPhase) * 0.5;
    if(f.y > confettiCanvas.height){ 
      f.y = -10; 
      f.x = Math.random() * confettiCanvas.width;
    }
  });
  requestAnimationFrame(drawConfetti);
}

drawConfetti();

window.addEventListener('resize',()=>{
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
});

// Voiceover functionality
let passwordUnlocked = false;
const voiceoverAudios = {
  personal: document.getElementById('voiceover-personal'),
  memories: document.getElementById('voiceover-memories'),
  secret: document.getElementById('voiceover-secret'),
  letters: document.getElementById('voiceover-letters'),
  dragon: document.getElementById('voiceover-dragon')
};

// Stop all voiceovers except the one specified
function stopAllVoiceovers(except = null) {
  Object.keys(voiceoverAudios).forEach(key => {
    if (key !== except && voiceoverAudios[key]) {
      voiceoverAudios[key].pause();
      voiceoverAudios[key].currentTime = 0;
      updateVoiceoverButton(key, false);
    }
  });
}

// Toggle voiceover playback
function toggleVoiceover(type) {
  const audio = voiceoverAudios[type];
  const btn = document.querySelector(`#voiceover-control-${type} .voiceover-btn`);
  const status = document.getElementById(`status-${type}`);
  
  if (!audio) return;
  
  if (audio.paused) {
    // Stop all other voiceovers before playing this one
    stopAllVoiceovers(type);
    
    audio.play().then(() => {
      btn.textContent = '‚è∏Ô∏è Pause Voice Message';
      btn.classList.add('playing');
      status.textContent = 'Playing...';
    }).catch(err => {
      console.log('Playback error:', err);
      status.textContent = 'Error playing audio';
    });
  } else {
    audio.pause();
    updateVoiceoverButton(type, false);
  }
}

// Update button state
function updateVoiceoverButton(type, isPlaying) {
  const btn = document.querySelector(`#voiceover-control-${type} .voiceover-btn`);
  const status = document.getElementById(`status-${type}`);
  
  if (!btn) return;
  
  if (isPlaying) {
    btn.textContent = '‚è∏Ô∏è Pause Voice Message';
    btn.classList.add('playing');
    status.textContent = 'Playing...';
  } else {
    btn.textContent = '‚ñ∂Ô∏è Play Voice Message';
    btn.classList.remove('playing');
    status.textContent = '';
  }
}

// Add event listeners for when audio ends
Object.keys(voiceoverAudios).forEach(type => {
  const audio = voiceoverAudios[type];
  if (audio) {
    audio.addEventListener('ended', () => {
      updateVoiceoverButton(type, false);
      const status = document.getElementById(`status-${type}`);
      if (status) status.textContent = 'Finished';
    });
    
    audio.addEventListener('pause', () => {
      if (audio.currentTime < audio.duration) {
        updateVoiceoverButton(type, false);
      }
    });
  }
});

// Secret audio progress bar functionality
const secretAudio = document.getElementById('voiceover-secret');
const secretProgress = document.getElementById('secret-progress');
const secretCurrentTime = document.getElementById('secret-current-time');
const secretDuration = document.getElementById('secret-duration');

function formatTime(seconds) {
  const mins = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}

if (secretAudio && secretProgress) {
  // Force load metadata
  secretAudio.load();
  
  // Update duration when metadata loads
  secretAudio.addEventListener('loadedmetadata', () => {
    if (secretAudio.duration && secretAudio.duration !== Infinity) {
      secretDuration.textContent = formatTime(secretAudio.duration);
      secretProgress.max = secretAudio.duration;
    }
  });

  // Update progress bar as audio plays
  secretAudio.addEventListener('timeupdate', () => {
    secretProgress.value = secretAudio.currentTime;
    secretCurrentTime.textContent = formatTime(secretAudio.currentTime);
    // Update max in case it wasn't set yet
    if (secretAudio.duration && secretAudio.duration !== Infinity && secretProgress.max != secretAudio.duration) {
      secretProgress.max = secretAudio.duration;
      secretDuration.textContent = formatTime(secretAudio.duration);
    }
  });

  // Allow seeking via progress bar
  secretProgress.addEventListener('input', (e) => {
    secretAudio.currentTime = e.target.value;
  });
}

// Window functions
function closeAll(){
  document.querySelectorAll('.window').forEach(w => w.style.display = 'none');
}

function openWindow(id){
  const w = document.getElementById(id);
  w.style.display = 'block';
  requestAnimationFrame(() => {});
}

function closeWindow(btn) {
  const win = btn.closest('.window');
  if (win) win.style.display = 'none';
}

// Draggable folders
let current=null, offsetX=0, offsetY=0;

function startDrag(e,el){
  current=el;
  offsetX=e.clientX-el.offsetLeft;
  offsetY=e.clientY-el.offsetTop;
  document.onmousemove=drag;
  document.onmouseup=stopDrag;
}

function drag(e){
  if(!current) return;
  current.style.left=(e.clientX-offsetX)+"px";
  current.style.top=(e.clientY-offsetY)+"px";
}

function stopDrag(){
  current=null;
  document.onmousemove=null;
}

// Draggable windows
let winCurrent=null, winOffsetX=0, winOffsetY=0;

function startDragWindow(e,win){
  winCurrent=win;
  winOffsetX=e.clientX-win.offsetLeft;
  winOffsetY=e.clientY-win.offsetTop;
  document.onmousemove=dragWindow;
  document.onmouseup=stopDragWindow;
}

function dragWindow(e){
  if(!winCurrent) return;
  winCurrent.style.left=(e.clientX-winOffsetX)+"px";
  winCurrent.style.top=(e.clientY-winOffsetY)+"px";
  winCurrent.style.transform="";
}

function stopDragWindow(){
  winCurrent=null;
  document.onmousemove=null;
}

// Boot screen
const bootScreen = document.getElementById('boot-screen');
const bootProgress = document.getElementById('boot-progress');
const musicOverlay = document.getElementById('music-start');
let p = 0;

const bootInterval = setInterval(() => {
  p += 6;
  bootProgress.style.width = p + '%';
  if (p >= 100) {
    clearInterval(bootInterval);
    bootScreen.style.display = 'none';
    if (musicOverlay) musicOverlay.style.display = 'flex';
  }
}, 120);

// Music player
const tracks = [
  {
    title: "petal",
    url: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/petal.mp3"
  },
 {
    title: "talk",
    url: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/talk.mp3"
  },
  {
    title: "magnolia",
    url: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/magnolia.mp3"
  },
  {
    title: "otis",
    url: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/otis.mp3"
  },
  {
    title: "ocean",
    url: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/ocean.mp3"
  },
  {
    title: "halah",
    url: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/halah.mp3"
  },
  {
    title: "horses",
    url: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/horses.mp3"
  },
  {
    title: "sunsetz",
    url: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/sunsetz.mp3"
  },
  {
    title: "mystery",
    url: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/mystery.mp3"
  },
  {
    title: "wichita",
    url: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/wichita.mp3"
  },
  {
    title: "lost",
    url: "https://github.com/happy-birthday-free-bird/rose-birthday/raw/main/lost.mp3"
  }
];

let currentTrackIndex = 0;
let isPlaying = false;
let isMuted = false;

const bgMusic = document.getElementById('bg-music');
const musicBtn = document.getElementById('music-btn');
const musicControls = document.getElementById('music-controls');
const muteBtn = document.getElementById('mute-btn');
const skipBtn = document.getElementById('skip-btn');
const playPauseBtn = document.getElementById('play-pause-btn');
const trackTitle = document.getElementById('track-title');
const trackCounter = document.getElementById('track-counter');

function updateTrackInfo() {
  trackTitle.textContent = tracks[currentTrackIndex].title;
  trackCounter.textContent = `Track ${currentTrackIndex + 1} of ${tracks.length}`;
}

function loadTrack(index) {
  currentTrackIndex = index % tracks.length;
  const track = tracks[currentTrackIndex];
  bgMusic.src = track.url;
  bgMusic.load();
  updateTrackInfo();
  if (isPlaying) {
    bgMusic.play().catch(err => console.log('Play error:', err));
  }
}

function skipTrack() {
  loadTrack(currentTrackIndex + 1);
}

function toggleMute() {
  isMuted = !isMuted;
  bgMusic.muted = isMuted;
  muteBtn.textContent = isMuted ? 'üîá hear the music' : 'üîä silence please';
}

function togglePlayPause() {
  if (isPlaying) {
    bgMusic.pause();
    isPlaying = false;
    playPauseBtn.textContent = '‚ñ∂Ô∏è play';
  } else {
    bgMusic.play().catch(err => console.log('Play error:', err));
    isPlaying = true;
    playPauseBtn.textContent = '‚è∏Ô∏è pause';
  }
}

bgMusic.addEventListener('ended', () => {
  skipTrack();
});

const startMusicAndClose = () => {
  if (musicOverlay) musicOverlay.style.display = 'none';
  if (!bgMusic) return;
  
  musicControls.classList.add('active');
  loadTrack(0);
  bgMusic.currentTime = 0;
  bgMusic.play().then(() => {
    isPlaying = true;
    playPauseBtn.textContent = '‚è∏Ô∏è pause';
  }).catch(() => {});
};

if (musicBtn) {
  musicBtn.addEventListener('click', startMusicAndClose);
}

if (muteBtn) {
  muteBtn.addEventListener('click', toggleMute);
}

if (skipBtn) {
  skipBtn.addEventListener('click', skipTrack);
}

if (playPauseBtn) {
  playPauseBtn.addEventListener('click', togglePlayPause);
}

['click','touchstart','keydown'].forEach(ev => {
  window.addEventListener(ev, function once() {
    startMusicAndClose();
    window.removeEventListener(ev, once);
  }, { once: true });
});

updateTrackInfo();

// Background colour changer
const win98Colors = ['#0D4260', '#006a4e', '#53181D', '#765321']; 
let currentBg = 0;

document.body.addEventListener('click', () => {
  currentBg = (currentBg + 1) % win98Colors.length;
  document.body.style.backgroundColor = win98Colors[currentBg];
});

// Window scaling
document.querySelectorAll('.window').forEach(win => {
  const wrapper = win.querySelector('.scale-wrapper');
  if (!wrapper) return;

  let baseWidth = null;

  const observer = new ResizeObserver(entries => {
    for (let entry of entries) {
      if (!baseWidth && entry.contentRect.width > 0) {
        baseWidth = entry.contentRect.width;
      }
      if (!baseWidth) return;
      const newWidth = entry.contentRect.width;
      const scale = newWidth / baseWidth;
      wrapper.style.transform = `scale(${scale})`;
      wrapper.style.width = `${100 / scale}%`;
    }
  });

  observer.observe(win);
});

// Resize handles
document.querySelectorAll('.window').forEach(win => {
  const handle = document.createElement('div');
  handle.classList.add('resize-handle');
  win.appendChild(handle);

  let resizing = false;
  let startX, startY, startWidth, startHeight;

  handle.addEventListener('mousedown', e => {
    e.stopPropagation();
    resizing = true;
    startX = e.clientX;
    startY = e.clientY;
    const rect = win.getBoundingClientRect();
    startWidth = rect.width;
    startHeight = rect.height;
    document.onmousemove = resize;
    document.onmouseup = stopResize;
  });

  function resize(e) {
    if (!resizing) return;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    const newWidth = Math.max(200, startWidth + dx);
    const newHeight = Math.max(100, startHeight + dy);
    win.style.width = newWidth + 'px';
    win.style.height = newHeight + 'px';
  }

  function stopResize() {
    resizing = false;
    document.onmousemove = null;
    document.onmouseup = null;
  }
});

function checkDragonPassword() {
  const password = document.getElementById('dragonPassword').value;
  const correctPassword = "vixen"; 
  
  if (password === correctPassword) {
    passwordUnlocked = true;
    document.querySelector('.dragon-guard').style.display = 'none';
    document.getElementById('secretContent').style.display = 'block';
    document.getElementById('passwordError').style.display = 'none';
    
    // Show the Norm video in the secret folder
    document.getElementById('crossword-video-reveal').style.display = 'block';
    
    // Check if crossword was completed - if so, dragon voiceover should be visible
    const dragonControl = document.getElementById('voiceover-control-dragon');
    console.log('Password entered! Checking dragon control...');
    console.log('Dragon control found:', dragonControl);
    console.log('Has active class:', dragonControl ? dragonControl.classList.contains('active') : 'N/A');
    
    // If crossword was already completed, the control will have 'active' class
    // We just need to make sure it's visible now that secretContent is showing
    if (dragonControl && dragonControl.classList.contains('active')) {
      // It was already unlocked by crossword, just make sure it's visible
      console.log('‚úÖ Dragon voiceover should now be visible!');
    }

  } else {
    passwordAttempts++;
    
    if (passwordAttempts === 1) {
      document.getElementById('passwordError').textContent = "Wrong password! The dragon won't let you pass.";
      document.getElementById('passwordError').style.display = 'block';
    } else {
      document.getElementById('passwordError').innerHTML = "Wrong again! üí° <strong>Hint:</strong> there's one nickname I haven't called you here... what is it? ü¶å";
      document.getElementById('passwordError').style.display = 'block';
    }
    
    document.getElementById('dragonPassword').value = '';
    
    const dragonBox = document.querySelector('.pixel-dragon');
    dragonBox.style.animation = 'none';
    setTimeout(() => {
      dragonBox.style.animation = 'shake 0.5s, dragonGlow 2s infinite alternate';
    }, 10);
  }
}

// Allow Enter key to submit password
document.getElementById('dragonPassword').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    checkDragonPassword();
  }
});

let totalClicks = 0;
let errorShown = false;

document.addEventListener('click', function(e) {
  // Don't count clicks inside crossword window
  if (e.target.closest('#crossword')) return;
  
  if (!errorShown) {
    totalClicks++;
    
    if (totalClicks === 20) {
      errorShown = true;
      setTimeout(() => {
        if (confirm('‚ö†Ô∏è SYSTEM ERROR ‚ö†Ô∏è\n\nUnauthorised dragon activity detected...\n\nClick OK to see what the fuss is all about.')) {
          openWindow('secret-folder');
          showDragonIcon();
        } else {
          setTimeout(() => {
            alert('üêâ WARNING üêâ\n\nThe dragon doesnt like being cancelled on...\n\nYou MUST face it...');
            openWindow('secret-folder');
            showDragonIcon();
          }, 1000);
        }
      }, 300);
    }
  }
});

function showDragonIcon() {
  const dragonIcon = document.getElementById('persistent-dragon-icon');
  dragonIcon.style.display = 'block';
  dragonIcon.style.animation = 'fadeIn 0.5s';
}

let passwordAttempts = 0;

</script>

<script>
// CROSSWORD JAVASCRIPT - CORRECTED VERSION
(function() {

// All the words with their clues
const wordsData = [
  {word: 'BOLIVIA', clue: "next time I say let's go someplace like..., lets GO someplace like...!"},
  {word: 'CHOCOLATE', clue: 'the flavour ice cream you need to try with chips'},
  {word: 'EVENSONG', clue: 'this caused some fruitful thinking time'},
  {word: 'EYES', clue: 'the uber driver liked me so much. he saw it in my...'},
  {word: 'GIMP', clue: 'what you are'},
  {word: 'GLORIOUS', clue: 'how did you describe the day that involved pizza popcorn chicken and cider'},
  {word: 'GREEN', clue: 'the colour of the dress you thought would rid me of any maturity'},
  {word: 'INTENTIONS', clue: 'what is the only thing that matters when kissing someone ill'},
  {word: 'LILIES', clue: 'the first flowers I bought you'},
  {word: 'NICE', clue: 'your second favourite biscuit'},
  {word: 'PICKEREL', clue: 'you have strong feelings about this pub'},
  {word: 'SQUIRE', clue: 'library you tried because of me'},
  {word: 'STUNNINGLY', clue: 'how intelligent I said you came across on the night I met you'},
  {word: 'TOOL', clue: 'the word you missed hearing the most on our call after junction'},
  {word: 'BLEATS', clue: 'what does Alex mcgarry do'},
  {word: 'BREAKFAST', clue: 'when do happy dreams get analysed'},
  {word: 'COOLNESS', clue: 'what status was granted (for infinity) to the winner of our essay race'},
  {word: 'DEFINITELY', clue: 'word you misspelt in your message in the book you gave me'},
  {word: 'DUGONG', clue: "my favourite animal not to be mistaken for somewhere you'd find a gimp"},
  {word: 'EDGAR', clue: 'your favourite Anglo Saxon king'},
  {word: 'GINGER', clue: 'your favourite biscuit, and NOT anything even remotely close to your hair'},
  {word: 'GRUBBER', clue: "my sloth teddy's name"},
  {word: 'HALLOWEEN', clue: 'which episodes of Brooklyn 99 did you liken our late night instagram chats to'},
  {word: 'KAHAILA', clue: 'a brick lane haunt'},
  {word: 'MASK', clue: 'object you forgot to give me the first time we worked in the same library and had our first long break'},
  {word: 'MLKJR', clue: 'which famous historical figure compared themselves to Napoleon on a first conversation with their wife-to-be'},
  {word: 'PALE', clue: 'you were surprised by how...you appeared in junction when you saw yourself in my phone'},
  {word: 'STUMBLE', clue: 'I try to walk away and i'},
  {word: 'TACTICAL', clue: 'how did you describe my flirtation'},
  {word: 'EFFECTIVE', clue: 'describes something that produces a desired or intended result, works well in practice, or is currently in force'},
  {word: 'AFFECTIVE', clue: 'relating to, arising from, or influencing emotions and feelings'},
  {word: 'STRANGER', clue: 'hey'},
  {word: 'OWL', clue: 'your twin in the Fitz'},
  {word: 'CANOODLING', clue: 'whenever a bench appeared we could be found doing this (to your feigned horror)'},
  {word: 'CHIPS', clue: 'your sustenance'},
  {word: 'TWELVE', clue: 'how old was the version of Hanif being addressed in the passage I sent you'},
  {word: 'SMIRK', clue: 'I got a unique version of this classic rose trademark'},
  {word: 'MISCHIEVOUS', clue: 'you were surprised at how expressive your face was around me, but how did you say i looked "at all points"'},
  {word: 'BREACHES', clue: 'breaking at the'},
 {word: 'HORSE', clue: 'animal featured in the norm joke told bottom floor of squire'},
 {word: 'MOTH', clue: 'animal featured in the norm joke told as the lights dimmed in the cinema'},
 {word: 'DOG', clue: 'animal featured in the norm joke told after junction on the phone'},
{word: 'HERGE', clue: 'Georges Prosper Remi'},
{word: 'PROMISCUOUS', clue: 'not prim and proper, but prim and'},
{word: 'MOORGATE', clue: 'where ismail completely forgot about being even remotely afraid of escalators'},
{word: 'HUGE', clue: 'an ismail staple'},
{word: 'FORTUNATELY', clue: 'very... ismail'},
{word: 'APPLES', clue: 'How do you like them'},
{word: 'PORTCULLIS', clue: 'You let this down in front of safi‚Äôs parents'},
{word: 'UNCOUTH', clue: 'Eughhhheewww that‚Äôs so'},
{word: 'NICHELY', clue: 'A word you made up'},
  {word: 'SEVEN', clue: ''}
];

function layoutCrossword(words) {
  let attempts = 0;
  let placedWords = [];
  
  // Try up to 10 times to generate a fully connected crossword
  while (attempts < 10) {
    placedWords = attemptLayout(words);
    if (isFullyConnected(placedWords)) {
      return placedWords;
    }
    attempts++;
  }
  
  // If we still don't have a good one, return the best attempt
  return placedWords;
}

function attemptLayout(words) {
  words = words.map(w => ({...w})); // Clone to avoid modifying original
  
  // Randomize the order (except keep longest word first for stability)
  words.sort((a, b) => b.word.length - a.word.length);
  const firstWord = words[0];
  const restWords = words.slice(1);
  
  // Shuffle the rest
  for (let i = restWords.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [restWords[i], restWords[j]] = [restWords[j], restWords[i]];
  }
  
  words = [firstWord, ...restWords];
  
  const placed = [];
  const gridSize = 30;
  const grid = Array(gridSize).fill(null).map(() => Array(gridSize).fill(null));
  
  const startRow = Math.floor(gridSize / 2);
  const startCol = Math.floor((gridSize - firstWord.word.length) / 2);
  
  placed.push({...firstWord, row: startRow, col: startCol, dir: 'across'});
  for (let i = 0; i < firstWord.word.length; i++) {
    grid[startRow][startCol + i] = firstWord.word[i];
  }
  
  for (let i = 1; i < words.length; i++) {
    const word = words[i];
    let placed_word = false;
    
    // Shuffle the order we check existing words
    const placedShuffled = [...placed].sort(() => Math.random() - 0.5);
    
    for (let p of placedShuffled) {
      if (placed_word) break;
      for (let wi = 0; wi < word.word.length; wi++) {
        if (placed_word) break;
        for (let pi = 0; pi < p.word.length; pi++) {
          if (word.word[wi] === p.word[pi]) {
            let newRow, newCol, newDir;
            if (p.dir === 'across') {
              newDir = 'down';
              newRow = p.row - wi;
              newCol = p.col + pi;
            } else {
              newDir = 'across';
              newRow = p.row + pi;
              newCol = p.col - wi;
            }
            
            if (canPlace(grid, word.word, newRow, newCol, newDir, gridSize)) {
              placed.push({...word, row: newRow, col: newCol, dir: newDir});
              for (let j = 0; j < word.word.length; j++) {
                const r = newDir === 'down' ? newRow + j : newRow;
                const c = newDir === 'across' ? newCol + j : newCol;
                grid[r][c] = word.word[j];
              }
              placed_word = true;
              break;
            }
          }
        }
      }
    }
    
    // Skip words that don't fit rather than placing them randomly
    if (!placed_word) {
      console.log(`Could not place word: ${word.word}`);
    }
  }
  return placed;
}
function isFullyConnected(words) {
  if (words.length === 0) return false;
  
  // Build adjacency map
  const connected = new Set();
  connected.add(0); // Start with first word
  
  let changed = true;
  while (changed) {
    changed = false;
    for (let i = 0; i < words.length; i++) {
      if (connected.has(i)) continue;
      
      // Check if this word intersects with any connected word
      for (let j of connected) {
        if (wordsIntersect(words[i], words[j])) {
          connected.add(i);
          changed = true;
          break;
        }
      }
    }
  }
  
  return connected.size === words.length;
}

function wordsIntersect(word1, word2) {
  // Check if two words share a cell
  for (let i = 0; i < word1.word.length; i++) {
    const r1 = word1.dir === 'down' ? word1.row + i : word1.row;
    const c1 = word1.dir === 'across' ? word1.col + i : word1.col;
    
    for (let j = 0; j < word2.word.length; j++) {
      const r2 = word2.dir === 'down' ? word2.row + j : word2.row;
      const c2 = word2.dir === 'across' ? word2.col + j : word2.col;
      
      if (r1 === r2 && c1 === c2) {
        return true;
      }
    }
  }
  return false;
}

function canPlace(grid, word, row, col, dir, gridSize) {
  if (row < 0 || col < 0) return false;
  const endRow = dir === 'down' ? row + word.length : row + 1;
  const endCol = dir === 'across' ? col + word.length : col + 1;
  if (endRow > gridSize || endCol > gridSize) return false;
  
  for (let i = 0; i < word.length; i++) {
    const r = dir === 'down' ? row + i : row;
    const c = dir === 'across' ? col + i : col;
    
    if (grid[r][c] !== null && grid[r][c] !== word[i]) return false;
    
    if (dir === 'across') {
      if (grid[r - 1] && grid[r - 1][c] !== null && grid[r][c] !== word[i]) return false;
      if (grid[r + 1] && grid[r + 1][c] !== null && grid[r][c] !== word[i]) return false;
      if (i === 0 && grid[r][c - 1] !== null) return false;
      if (i === word.length - 1 && grid[r][c + 1] !== null) return false;
    } else {
      if (grid[r][c - 1] !== null && grid[r][c] !== word[i]) return false;
      if (grid[r][c + 1] !== null && grid[r][c] !== word[i]) return false;
      if (i === 0 && grid[r - 1] && grid[r - 1][c] !== null) return false;
      if (i === word.length - 1 && grid[r + 1] && grid[r + 1][c] !== null) return false;
    }
  }
  return true;
}

let currentWord = null;
let currentDirection = 'across';

function getWordsAtCell(row, col) {
  const placedWords = window.crosswordPlacedWords || [];
  return placedWords.filter(w => {
    if (w.dir === 'across') {
      return w.row === row && col >= w.col && col < w.col + w.word.length;
    } else {
      return w.col === col && row >= w.row && row < w.row + w.word.length;
    }
  });
}

function getCellsForWord(word) {
  const cells = [];
  for (let i = 0; i < word.word.length; i++) {
    const r = word.dir === 'down' ? word.row + i : word.row;
    const c = word.dir === 'across' ? word.col + i : word.col;
    cells.push({row: r, col: c});
  }
  return cells;
}

function highlightWord(word) {
  document.querySelectorAll('.crossword-cell').forEach(cell => {
    cell.style.background = '';
  });
  if (!word) return;
  const cells = getCellsForWord(word);
  cells.forEach(cell => {
    const input = document.querySelector(`input[data-row="${cell.row}"][data-col="${cell.col}"]`);
    if (input && !input.parentElement.classList.contains('correct')) {
      input.parentElement.style.background = '#e6f3ff';
    }
  });
}

function handleInput(e) {
  const input = e.target;
  const val = input.value.toUpperCase();
  input.value = val;
  if (val === input.dataset.answer) {
    input.parentElement.classList.add('correct');
    if (val) moveToNextInWord(input);
    checkComplete();
  } else if (val) {
    input.parentElement.classList.remove('correct');
  }
}

function handleKeydown(e) {
  if (e.key === 'Backspace' && !e.target.value) {
    e.preventDefault();
    moveToPrevInWord(e.target);
  } else if (e.key === ' ') {
    e.preventDefault();
    toggleDirection(e.target);
  } else if (e.key === 'ArrowRight' && currentDirection === 'across') {
    e.preventDefault();
    moveToNextInWord(e.target);
  } else if (e.key === 'ArrowLeft' && currentDirection === 'across') {
    e.preventDefault();
    moveToPrevInWord(e.target);
  } else if (e.key === 'ArrowDown' && currentDirection === 'down') {
    e.preventDefault();
    moveToNextInWord(e.target);
  } else if (e.key === 'ArrowUp' && currentDirection === 'down') {
    e.preventDefault();
    moveToPrevInWord(e.target);
  }
}

function selectWordAtCell(row, col) {
  const wordsHere = getWordsAtCell(row, col);
  if (wordsHere.length === 0) return;
  
  if (currentWord && currentWord.row === wordsHere[0].row && currentWord.col === wordsHere[0].col) {
    const otherDir = wordsHere.find(w => w.dir !== currentDirection);
    if (otherDir) {
      currentWord = otherDir;
      currentDirection = otherDir.dir;
    }
  } else {
    currentWord = wordsHere.find(w => w.dir === 'across') || wordsHere[0];
    currentDirection = currentWord.dir;
  }
  highlightWord(currentWord);
}

function toggleDirection(input) {
  const row = parseInt(input.dataset.row);
  const col = parseInt(input.dataset.col);
  const wordsHere = getWordsAtCell(row, col);
  if (wordsHere.length > 1) {
    const otherDir = wordsHere.find(w => w.dir !== currentDirection);
    if (otherDir) {
      currentWord = otherDir;
      currentDirection = otherDir.dir;
      highlightWord(currentWord);
    }
  }
}

function moveToNextInWord(input) {
  if (!currentWord) return;
  const row = parseInt(input.dataset.row);
  const col = parseInt(input.dataset.col);
  const cells = getCellsForWord(currentWord);
  const currentIdx = cells.findIndex(c => c.row === row && c.col === col);
  if (currentIdx >= 0 && currentIdx < cells.length - 1) {
    const next = cells[currentIdx + 1];
    const nextInput = document.querySelector(`input[data-row="${next.row}"][data-col="${next.col}"]`);
    if (nextInput) nextInput.focus();
  }
}

function moveToPrevInWord(input) {
  if (!currentWord) return;
  const row = parseInt(input.dataset.row);
  const col = parseInt(input.dataset.col);
  const cells = getCellsForWord(currentWord);
  const currentIdx = cells.findIndex(c => c.row === row && c.col === col);
  if (currentIdx > 0) {
    const prev = cells[currentIdx - 1];
    const prevInput = document.querySelector(`input[data-row="${prev.row}"][data-col="${prev.col}"]`);
    if (prevInput) prevInput.focus();
  }
}

function checkComplete() {
  const allInputs = document.querySelectorAll('.crossword-cell input');
  const allCorrect = Array.from(allInputs).every(input => 
    input.value.toUpperCase() === input.dataset.answer
  );
  
  console.log('checkComplete called, all correct:', allCorrect);
  
  if (allCorrect && allInputs.length > 0) {
    document.getElementById('crossword-complete-msg').style.display = 'block';
    document.getElementById('crossword-video-reveal').style.display = 'block';
    document.getElementById('crossword-secret-box').style.display = 'block';

    console.log('About to unlock voiceovers...');
    
    // Get the dragon control DIRECTLY like the blue button does
    const dragonControl = document.getElementById('voiceover-control-dragon');
    console.log('Dragon control element:', dragonControl);
    
    if (dragonControl) {
      console.log('BEFORE - classList:', dragonControl.classList);
      console.log('BEFORE - style.display:', dragonControl.style.display);
      console.log('BEFORE - computed display:', window.getComputedStyle(dragonControl).display);
      
      // Do EXACTLY what blue button does
      dragonControl.classList.add('active');
      dragonControl.style.display = 'block';
      
      console.log('AFTER - classList:', dragonControl.classList);
      console.log('AFTER - style.display:', dragonControl.style.display);
      console.log('AFTER - computed display:', window.getComputedStyle(dragonControl).display);
    }
    
    // Also unlock the other voiceovers
    ['voiceover-control-personal', 'voiceover-control-memories', 'voiceover-control-letters'].forEach(controlId => {
      const control = document.getElementById(controlId);
      if (control) {
        control.classList.add('active');
        control.style.display = 'block';
      }
    });

  

    setTimeout(() => {
      document.getElementById('crossword-video-reveal').scrollIntoView({behavior: 'smooth', block: 'center'});
    }, 500);
  }
}
 
function initializeCrosswordGrid() {
  const placedWords = layoutCrossword(wordsData.map(w => ({...w})));
  let minRow = 30, minCol = 30, maxRow = 0, maxCol = 0;
  
  placedWords.forEach(w => {
    minRow = Math.min(minRow, w.row);
    minCol = Math.min(minCol, w.col);
    const endRow = w.dir === 'down' ? w.row + w.word.length - 1 : w.row;
    const endCol = w.dir === 'across' ? w.col + w.word.length - 1 : w.col;
    maxRow = Math.max(maxRow, endRow);
    maxCol = Math.max(maxCol, endCol);
  });

  placedWords.forEach(w => {
    w.row -= minRow;
    w.col -= minCol;
  });

  const gridRows = maxRow - minRow + 1;
  const gridCols = maxCol - minCol + 1;
  const grid = Array(gridRows).fill(null).map(() => 
    Array(gridCols).fill(null).map(() => ({letter: null, num: null, black: true}))
  );

  placedWords.forEach(w => {
    for (let i = 0; i < w.word.length; i++) {
      const r = w.dir === 'down' ? w.row + i : w.row;
      const c = w.dir === 'across' ? w.col + i : w.col;
      if (!grid[r][c].letter) {
        grid[r][c] = {letter: w.word[i], num: null, black: false};
      }
    }
  });

  // First pass: number normally and track which cell gets #6
  let clueNum = 1;
  let cell6 = null;
  let sevenWord = placedWords.find(w => w.word === 'SEVEN');
  
  for (let r = 0; r < gridRows; r++) {
    for (let c = 0; c < gridCols; c++) {
      if (grid[r][c].black) continue;
      const wordsStartingHere = placedWords.filter(w => w.row === r && w.col === c);
      if (wordsStartingHere.length > 0) {
        if (clueNum === 6) {
          cell6 = {row: r, col: c, words: wordsStartingHere};
        }
        grid[r][c].num = clueNum;
        wordsStartingHere.forEach(w => { w.num = clueNum; });
        clueNum++;
      }
    }
  }
  
  // Now swap: give SEVEN the number 6, and give the word that had 6 SEVEN's old number
  if (sevenWord && cell6 && sevenWord.num !== 6) {
    const sevenOrigNum = sevenWord.num;
    
    // Update SEVEN to be #6
    sevenWord.num = 6;
    grid[sevenWord.row][sevenWord.col].num = 6;
    
    // Update the words that were at cell #6 to have SEVEN's old number
    cell6.words.forEach(w => {
      w.num = sevenOrigNum;
    });
    grid[cell6.row][cell6.col].num = sevenOrigNum;
  }

  const gridEl = document.getElementById('crossword-grid');
  gridEl.innerHTML = '';
  gridEl.style.gridTemplateColumns = `repeat(${gridCols}, 28px)`;
  gridEl.style.gridTemplateRows = `repeat(${gridRows}, 28px)`;

  grid.forEach((row, r) => {
    row.forEach((cell, c) => {
      const cellDiv = document.createElement('div');
      cellDiv.className = 'crossword-cell';
      
      if (cell.black) {
        cellDiv.classList.add('black');
      } else {
        const input = document.createElement('input');
        input.type = 'text';
        input.maxLength = 1;
        input.dataset.row = r;
        input.dataset.col = c;
        input.dataset.answer = cell.letter;
        input.addEventListener('input', handleInput);
        input.addEventListener('keydown', handleKeydown);
        input.addEventListener('click', () => selectWordAtCell(r, c));
        input.addEventListener('focus', () => { if (!currentWord) selectWordAtCell(r, c); });
        cellDiv.appendChild(input);
        
        if (cell.num) {
          const numSpan = document.createElement('span');
          numSpan.className = 'cell-number';
          numSpan.textContent = cell.num;
          cellDiv.appendChild(numSpan);
        }
      }
      gridEl.appendChild(cellDiv);
    });
  });

  const acrossClues = document.getElementById('crossword-across-clues');
  const downClues = document.getElementById('crossword-down-clues');
  acrossClues.innerHTML = '';
  downClues.innerHTML = '';

  const acrossWords = placedWords.filter(w => w.dir === 'across').sort((a, b) => a.num - b.num);
  const downWords = placedWords.filter(w => w.dir === 'down').sort((a, b) => a.num - b.num);

  acrossWords.forEach(w => {
    const li = document.createElement('li');
    li.innerHTML = `<strong>${w.num}.</strong> ${w.clue}`;
    acrossClues.appendChild(li);
  });

  downWords.forEach(w => {
    const li = document.createElement('li');
    li.innerHTML = `<strong>${w.num}.</strong> ${w.clue}`;
    downClues.appendChild(li);
  });
  
  window.crosswordPlacedWords = placedWords;
}

// STORE the original openWindow function
const _originalOpenWindow = window.openWindow;

// REPLACE openWindow with our wrapper
window.openWindow = function(id) {
  // Call the original function first
  _originalOpenWindow(id);
  
  // Then check if we need to initialize crossword
  if (id === 'crossword') {
    const gridEl = document.getElementById('crossword-grid');
    if (gridEl && !gridEl.hasChildNodes()) {
      setTimeout(initializeCrosswordGrid, 50);
    }
  }
};

})();
</script>

<style>
.dragon-icon {
  position: fixed;
  top: 20px;
  right: 20px;
  font-size: 40px;
  cursor: pointer;
  z-index: 9999;
  background: #c0c0c0;
  border: 2px outset #fff;
  padding: 10px;
  box-shadow: 2px 2px 0 rgba(0,0,0,0.3);
  transition: transform 0.2s;
}

.dragon-icon:hover {
  transform: scale(1.1);
}

.dragon-icon:active {
  border-style: inset;
  transform: scale(0.95);
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0); }
  to { opacity: 1; transform: scale(1); }
}
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}

#secret-progress {
  -webkit-appearance: none;
  appearance: none;
  height: 6px;
  background: #ddd;
  outline: none;
  border-radius: 3px;
}

#secret-progress::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 14px;
  height: 14px;
  background: #000080;
  cursor: pointer;
  border-radius: 50%;
}

#secret-progress::-moz-range-thumb {
  width: 14px;
  height: 14px;
  background: #000080;
  cursor: pointer;
  border-radius: 50%;
  border: none;
}
</style>


</body>

</html>